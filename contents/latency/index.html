<!DOCTYPE html> 
<html lang='en-US' xml:lang='en-US'> 
<head> <title>Hidding the network jitter</title> 
<meta charset='utf-8' /> 
<meta content='TeX4ht (https://tug.org/tex4ht/)' name='generator' /> 
<meta content='width=device-width,initial-scale=1' name='viewport' /> 
<link href='index.css' rel='stylesheet' type='text/css' /> 
<meta content='index.tex' name='src' /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script async='async' id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js' type='text/javascript'></script>  
</head><body>
   <div class='maketitle'>
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class='titleHead'>Hidding the network jitter</h2>
 <div class='author'><a href='https://vicente-gonzalez-ruiz.github.io/'><span class='ecrm-1200'>Vicente González Ruiz</span></a> <span class='ecrm-1200'>&amp; </span><a href='https://www.marcoslupion.com/'><span class='ecrm-1200'>Marcos Lupión Lorente</span></a></div><br />
<div class='date'><span class='ecrm-1200'>October 20, 2023</span></div>
   </div>
   <h3 class='likesectionHead'><a id='x1-1000'></a>Contents</h3>
   <div class='tableofcontents'>
    <span class='sectionToc'>1 <a href='#x1-20001' id='QQ2-1-2'>Latencies</a></span>
<br />    <span class='sectionToc'>2 <a href='#x1-30002' id='QQ2-1-3'>Using a buffer to hidden the jitter</a></span>
<br />    <span class='sectionToc'>3 <a href='#x1-40003' id='QQ2-1-6'>What you have to do? (deliverables)</a></span>
<br />     <span class='subsectionToc'>3.1 <a href='#x1-50003.1' id='QQ2-1-7'>Measurement</a></span>
<br />     <span class='subsectionToc'>3.2 <a href='#x1-60003.2' id='QQ2-1-9'>Characterize the latency in different scenarios</a></span>
<br />     <span class='subsectionToc'>3.3 <a href='#x1-90003.3' id='QQ2-1-13'>Quantification of the QoE</a></span>
<br />     <span class='subsectionToc'>3.4 <a href='#x1-130003.4' id='QQ2-1-17'>(Optional) QoE considering the packet loss</a></span>
<br />     <span class='subsectionToc'>3.5 <a href='#x1-140003.5' id='QQ2-1-18'>Control of the buffer size in InterCom</a></span>
<br />     <span class='subsectionToc'>3.6 <a href='#x1-150003.6' id='QQ2-1-19'>Create the <span class='ectt-1000'>NAT_Traversal </span>module</a></span>
<br />    <span class='sectionToc'><a href='#Q1-1-20'>References</a></span>
   </div>
<!-- l. 8 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>1   </span> <a id='x1-20001'></a>Latencies</h3>
<!-- l. 10 --><p class='noindent'><a href='https://en.wikipedia.org/wiki/Latency_(engineering)#Communication_latency'>Communication latency</a> (also called <a href='https://en.wikipedia.org/wiki/Network_delay'>network delay</a> and <a href='https://en.wikipedia.org/wiki/End-to-end_delay'>end-to-end delay</a>) is the time
it takes for that a chunk of data (encapsulated in an <a href='https://en.wikipedia.org/wiki/Internet_Protocol'>IP</a> <a href='https://en.wikipedia.org/wiki/Network_packet'>packet</a> in the case of the
Internet) to travel from one point of the network to another. This time is relevant for
an intercom(municator) because the total latency \(t_u\) that users experiment can be
approximated by \begin {equation}  t_u = t_p + t_i, \label {eq:user_latency}  \end {equation}
where \(t_p\) is the <span class='ecti-1000'>propagation time </span>(or propagation latency) of the <a href='https://en.wikipedia.org/wiki/Telecommunications_link'>link</a> and \(t_i\) is the <span class='ecti-1000'>latency</span>
generated by the intercom.
                                                                  

                                                                  
</p><!-- l. 27 --><p class='indent'>   Due to the current design of the Internet <span class='cite'>[<a href='#XTanenbaum'>7</a>, <a href='#XStallings'>6</a>]</span> (where the available
<a href='https://en.wikipedia.org/wiki/Bandwidth_(computing)'>bandwidth</a> is shared on demand by the network users) \(t_p\) is variable
in time and cannot be controlled without using <a href='https://en.wikipedia.org/wiki/Quality_of_service'>Quality of Service
(QoS)</a><span class='footnote-mark'><a href='#fn1x0' id='fn1x0-bk'><sup class='textsuperscript'>1</sup></a></span><a id='x1-2001f1'></a> <span class='cite'>[<a href='#Xdordal2020intro'>1</a>]</span>.
In contrast, \(t_i\) is constant for a given intercom configuration/implementation.
</p><!-- l. 37 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>2   </span> <a id='x1-30002'></a>Using a buffer to hidden the jitter</h3>
<!-- l. 39 --><p class='noindent'>We can consider that the <a href='https://en.wikipedia.org/wiki/Quality_of_experience'>Quality of Experience (QoE)</a> provided by InterCom is
inversely proportional to the <a href='https://en.wikipedia.org/wiki/Packet_delay_variation'>jitter of the network</a> (see Fig. <a href='#x1-3001r1'>1<!-- tex4ht:ref: fig:timelines  --></a>-a). One solution (see
Fig. <a href='#x1-3001r1'>1<!-- tex4ht:ref: fig:timelines  --></a>-b) is the use of a <a href='https://en.wikipedia.org/wiki/Random_access'>random access</a> <a href='https://en.wikipedia.org/wiki/Data_buffer'>buffer</a> at the receiver side, where the chunks
are stored for a time large enough to hide the jitter <span class='cite'>[<a href='#XKurose-Ross'>4</a>]</span>.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<div class='center'>
<!-- l. 51 --><p class='noindent'>
</p><!-- l. 52 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/timelines.svg' /> </div>  </p></div>
<a id='x1-3001r1'></a>
<a id='x1-3002'></a>
<figcaption class='caption'><span class='id'>Figure 1: </span><span class='content'>Timelines of two InterCom interactions. On the left, the playback is
defective because some chunks are lost. On the right, the audio rendering is
correct because the playback has been delayed 2 chunk times (enough for this
example).
</span></figcaption><!-- tex4ht:label?: x1-3001r2  -->
                                                                  

                                                                  
   </figure>
<!-- l. 62 --><p class='indent'>   <a href='https://en.wikipedia.org/wiki/Jitter#Jitter_buffers'><span class='ecti-1000'>Dejitterizing </span>buffers</a><span class='footnote-mark'><a href='#fn2x0' id='fn2x0-bk'><sup class='textsuperscript'>2</sup></a></span><a id='x1-3003f2'></a>
are typically implemented as a circular buffer structure (see Fig. <a href='#x1-3005r2'>2<!-- tex4ht:ref: fig:circular_buffer  --></a>). In an ideal
situation (as depicted in the figure), the number of pending-to-be-played chunks
available in the buffer is half of the number of slots in the buffer, and the chunks have
arrived on time. In this example (Fig. <a href='#x1-3005r2'>2<!-- tex4ht:ref: fig:circular_buffer  --></a>), the receiver (where the chunks
are buffered) waits for 3 chunks before starting playing the chunk number
0.<span class='footnote-mark'><a href='#fn3x0' id='fn3x0-bk'><sup class='textsuperscript'>3</sup></a></span><a id='x1-3004f3'></a>
Notice that the number of slots in the buffer, \(2N\), must double the number of chunks
buffered during the buffering time proportional to \(N\), in order to hide a jitter of \(N\)
chunks-time. Notice also that this technique also introduces a \(N\) chunk-time delay in
the playback.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<div class='tabular'> <table class='tabular' id='TBL-2'><colgroup id='TBL-2-1g'><col id='TBL-2-1' /><col id='TBL-2-2' /><col id='TBL-2-3' /></colgroup><tr id='TBL-2-1-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-1-1' style='white-space:nowrap; text-align:center;'> <!-- l. 82 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/circular_buffer1.svg' /> </div>                                                                    </p></td><td class='td11' id='TBL-2-1-2' style='white-space:nowrap; text-align:center;'> <!-- l. 82 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/circular_buffer2.svg' /> </div>                                                                    </p></td><td class='td11' id='TBL-2-1-3' style='white-space:nowrap; text-align:center;'> <!-- l. 82 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/circular_buffer3.svg' /> </div>                                                                    </p></td>
</tr><tr id='TBL-2-2-' style='vertical-align:baseline;'><td class='td11' id='TBL-2-2-1' style='white-space:nowrap; text-align:center;'>                                 (a)                                                    </td><td class='td11' id='TBL-2-2-2' style='white-space:nowrap; text-align:center;'>                                 (b)                                                    </td><td class='td11' id='TBL-2-2-3' style='white-space:nowrap; text-align:center;'>                                 (c)                                                    </td></tr></table>
</div> <a id='x1-3005r2'></a>
<a id='x1-3006'></a>
<figcaption class='caption'><span class='id'>Figure 2: </span><span class='content'>A circular buffer with 6 slots (space for 6 chunks). Half of the buffer
is occupied (slots in gray) because the buffering time is 3 chunk times and 3
chunks (with chunk number 0, 1 and 2 in the beginning, subfigure (a)) have
been received. The first chunk to be played is chunk 0 (subfigure (b)). Then, a
new chunk (chunk number 3) is received and buffered (subfigure (c)).
</span></figcaption><!-- tex4ht:label?: x1-3005r2  -->
                                                                  

                                                                  
   </figure>
<!-- l. 94 --><p class='indent'>   For this new improved InterCom, users must provide a new parameter called
“<span class='ecti-1000'>buffering time</span>”. This value (typically expressed in milliseconds) should be large
enough to hide the network jitter but small enough to keep the end-to-end (user)
latency below some limit.
</p><!-- l. 99 --><p class='indent'>   The following guidelines have been used to implement the <span class='ecti-1000'>buffered </span>version of
InterCom:
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-3008x1'>The class Minimal has been <a href='https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)'>inherited</a> (extended) to implement a new class
     Buffering.
     </li>
<li class='enumerate' id='x1-3010x2'>In the payload of each UDP packet, a chunk number (a 16-bits counter)
     has been included in order to provide to the receiver the information which
     determine where to store the corresponding chunk in the circular buffer.
     </li>
<li class='enumerate' id='x1-3012x3'>
     <!-- l. 110 --><p class='noindent'>It has been taken into consideration that the critical part of InterCom (the
     method <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>record_send_and_play()</span></span></span>) is a method that runs as an <a href='https://en.wikipedia.org/wiki/Interrupt_handler'>interrup
     handler</a> that is called each time a new chunk is available in the <a href='https://en.wikipedia.org/wiki/Analog-to-digital_converter'>ADC</a>. More
     precisely:
         </p><ol class='enumerate2'>
<li class='enumerate' id='x1-3014x1'>To  minimize  the  latency,  the  recorded  chunks  are  sent  to  the
         interlocutor as soon as possible.
         </li>
<li class='enumerate' id='x1-3016x2'>The  playback  of  the  chunks  extracted  from  the  buffer  is  <a href='https://en.wikipedia.org/wiki/Gapless_playback'><span class='ecti-1000'>gapless</span></a>
         (without the occurrence of silences) as long as the chunks have been
         received on time.
         </li>
<li class='enumerate' id='x1-3018x3'>The lost<span class='footnote-mark'><a href='#fn4x0' id='fn4x0-bk'><sup class='textsuperscript'>4</sup></a></span><a id='x1-3019f4'></a>
         chunks are replaced by zero-chunks in the playback.</li></ol>
                                                                  

                                                                  
     </li>
<li class='enumerate' id='x1-3021x4'>A method <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>receive_and_buffer()</span></span></span> runs now in a different execution <a href='https://en.wikipedia.org/wiki/Thread_(computing)'>thread</a>,
     decoupled from the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>record_send_and_play()</span></span></span> method. But notice that this can
     be achieved without using the <a href='https://docs.python.org/3/library/threading.html'>threading</a> or <a href='https://docs.python.org/3/library/multiprocessing.html'>multiprocessing</a> packages because
     the interruption handler (the so called <span class='ecti-1000'>callback</span>() function in <a href='https://python-sounddevice.readthedocs.io/en/0.3.14/api.html'>sounddevice</a>)
     already runs in parallel with the main thread.</li></ol>
<!-- l. 142 --><p class='indent'>   This is an overview of the implementation:
</p>
   <!-- l. 144 -->
   <div class='lstlisting' id='listing-1'><span class='label'><a id='x1-3022r1'></a></span><span class='ecit-1000'>  </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>Interruption</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>handler</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3023r2'></a></span><span class='ectt-1000'>  </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>record_send_and_play</span></span><span style='color:#000000'><span class='ectt-1000'>():</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3024r3'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>chunk</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>record</span></span><span style='color:#000000'><span class='ectt-1000'>()</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(1)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3025r4'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>packed_chunk</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>pack</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>chunk</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(2)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3026r5'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>send</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>packed_chunk</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(3)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3027r6'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>chunk</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>unbuffer_next_chunk</span></span><span style='color:#000000'><span class='ectt-1000'>()</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(4)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3028r7'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>play</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>chunk</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(5)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3029r8'></a></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3030r9'></a></span><span class='ecit-1000'>  </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>Main</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(</span></span><span style='color:#000000'><span class='ecit-1000'>not</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>a</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>new</span></span><span style='color:#000000'><span class='ecit-1000'>)</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>thread</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3031r10'></a></span><span class='ectt-1000'>  </span><span style='color:#000000'><span class='ectt-1000'>def</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>receive_and_buffer</span></span><span style='color:#000000'><span class='ectt-1000'>():</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3032r11'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>packed_chunk</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>receive</span></span><span style='color:#000000'><span class='ectt-1000'>()</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(1)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3033r12'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>chunk_number</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>chunk</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>unpack</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>packed_chunk</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(2)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-3034r13'></a></span><span class='ectt-1000'>   </span><span style='color:#000000'><span class='ectt-1000'>buffer</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>chunk_number</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>chunk</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span class='ecit-1000'> </span><span style='color:#000000'><span class='ecit-1000'>#</span></span><span style='color:#000000'><span class='ecit-1000'> </span></span><span style='color:#000000'><span class='ecit-1000'>(3)</span></span></div>
   
<!-- l. 160 --><p class='indent'>   Notice that Step (4) of the method <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>record_send_and_play()</span></span></span> extracts from the buffer an
unpacked<span class='footnote-mark'><a href='#fn5x0' id='fn5x0-bk'><sup class='textsuperscript'>5</sup></a></span><a id='x1-3035f5'></a>
chunk. The chunks are buffered in Step (3) of the method <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>receive_and_buffer()</span></span></span>.
Note also that Step (1) of <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>receive_and_buffer()</span></span></span> is a blocking method that should
return with every new received chunk.
</p>
   <h3 class='sectionHead'><span class='titlemark'>3   </span> <a id='x1-40003'></a>What you have to do? (deliverables)</h3>
<!-- l. 190 --><p class='noindent'>In this milestone we are going to measure the QoE provided by our “minimal” (or
“NAT_traversal”) intercom when the network latency varies <a href='https://en.wikipedia.org/wiki/Randomness'>at random</a>. At this
point, we basically have two alternatives:
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-4002x1'>Run two instances of InterCom in two different <a href='https://en.wikipedia.org/wiki/Host_(network)'>host</a>s interconected by a
     communication link.
     </li>
<li class='enumerate' id='x1-4004x2'>Locally (in the same host), run instances<span class='footnote-mark'><a href='#fn6x0' id='fn6x0-bk'><sup class='textsuperscript'>6</sup></a></span><a id='x1-4005f6'></a>
     of InterCom and control the network latency.</li></ol>
<!-- l. 202 --><p class='noindent'>Each option has pros and cons, from which we can highlight that:
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-4007x1'>
     <!-- l. 204 --><p class='noindent'><span class='ecbx-1000'>Using a real link:</span> </p>
                                                                  

                                                                  
         <ul class='itemize1'>
         <li class='itemize'>(Pro) The use of real latency is going to show the true behavior
         of  InterCom  between  the  used  hosts,  which,  in  general,  is  quite
         impredictable (depend basically on the <a href='https://en.wikipedia.org/wiki/Network_congestion'>network congestion</a>).
         </li>
         <li class='itemize'>(Con) To run InterCom in two different hosts we will need to establish
         a direct communication between them and it is very likely that we will
         be in different LANs interconnected by one or more <a href='https://tecnologias-multimedia.github.io/contents/NAT_traversal/'>NAT devices</a> <span class='cite'>[<a href='#Xsrisuresh1999nat'>5</a>]</span>.</li></ul>
     </li>
<li class='enumerate' id='x1-4009x2'>
     <!-- l. 218 --><p class='noindent'><span class='ecbx-1000'>Using a simulated link:</span> </p>
         <ul class='itemize1'>
         <li class='itemize'>(Pro) The simulation of the link latency allows to control the behavior
         of the link, allowing, for example, to run InterCom in situations that
         are difficult to reproduce in a real network.
         </li>
         <li class='itemize'>(Con) The running environment must provide a way of controlling the
         latency between <a href='https://en.wikipedia.org/wiki/Process_(computing)'>processes</a>. Fortunately, in Linux<span class='footnote-mark'><a href='#fn7x0' id='fn7x0-bk'><sup class='textsuperscript'>7</sup></a></span><a id='x1-4010f7'></a>
         we can control the latency (and the <a href='https://en.wikipedia.org/wiki/Bit_rate'>bit-rate</a>) of the outgoing traffic
         (packets) using the command <a href='https://man7.org/linux/man-pages/man8/tc.8.html'><span class='ectt-1000'>tc</span></a> <span class='cite'>[<a href='#Xbert2012lartc'>3</a>]</span>.</li></ul>
     </li></ol>
<!-- l. 237 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>3.1   </span> <a id='x1-50003.1'></a>Measurement</h4>
<!-- l. 238 --><p class='noindent'>In most cases we will test InterCom only in our host. Therefore, it can be useful to
have an idea of how the latencies are, at least from a statistical point of
view.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<div class='center'>
<!-- l. 243 --><p class='noindent'>
</p><!-- l. 244 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/ping_timeline.svg' /> </div>  </p></div>
<a id='x1-5001r3'></a>
<a id='x1-5002'></a>
<figcaption class='caption'><span class='id'>Figure 3:  </span><span class='content'>Timeline  of  a  ping  interaction  between  two  hosts  A  and  B,
interconnected by simple communication link.
</span></figcaption><!-- tex4ht:label?: x1-5001r3  -->
                                                                  

                                                                  
   </figure>
<!-- l. 252 --><p class='indent'>   To measure latencies, we will use <a href='https://github.com/torvalds/linux/blob/master/net/ipv4/ping.c'><span class='ectt-1000'>ping</span></a> <span class='cite'>[<a href='#XKurose-Ross'>4</a>, <a href='#XForouzan'>2</a>]</span>, a tool that <a href='https://en.wikipedia.org/wiki/Ping_(networking_utility)'>sends</a> (one or more)
<a href='https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol'>ICMP</a> Echo Request messages to an IP address and waits for receiving (one or more)
ICMP Echo Reply messages generated by the (<a href='https://en.wikipedia.org/wiki/Operating_system'>OS</a> of that) host, measuring the so
called <a href='https://en.wikipedia.org/wiki/Round-trip_delay'>RTT</a> (Round-Trip Time). For example, in the Figure <a href='#x1-5001r3'>3<!-- tex4ht:ref: fig:ping_timeline  --></a> are described the
different time components in which a RTT can be decomposed. In this figure, \(t_t\)
stands for <span class='ecti-1000'>transmission time</span>, and \(t_p\) (again) for <span class='ecti-1000'>propagation time</span>. A simple
link (two wires, for example) using <a href='https://en.wikipedia.org/wiki/Time-division_multiple_access'>TDM</a> (Time-Domain Multiplexing) has
been supposed. For this reason, the propagation and transmission times are
identical in both directions. Notice that if the payload of the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> message has
only 64 bytes (the default value in most <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> implementations) and the bit
rate of the link is high, then \(t_p\gg t_t.\) In a LAN, for example, it also holds that \begin {equation}  \text {RTT} = 2t_p + 2t_t. \label {eq:RTT}  \end {equation}
</p>
   <h4 class='subsectionHead'><span class='titlemark'>3.2   </span> <a id='x1-60003.2'></a>Characterize the latency in different scenarios</h4>
<!-- l. 282 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead'><span class='titlemark'>3.2.1   </span> <a id='x1-70003.2.1'></a>In your host</h5>
<!-- l. 284 --><p class='noindent'>Do the following steps:
</p><!-- l. 286 --><p class='indent'>
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-7002x1'>
     <!-- l. 287 --><p class='noindent'>Ping <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>localhost</span></span></span>: </p><!-- l. 288 -->
<a id='x1-7003'></a>
     <div class='lstlisting' id='listing-2'><span class='label'><a id='x1-7004r1'></a></span><span style='color:#000000'><span class='ectt-1000'>ping</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>localhost</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>-</span></span><span style='color:#000000'><span class='ectt-1000'>c</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>100</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>-</span></span><span style='color:#000000'><span class='ectt-1000'>s</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>payload_length_in_bytes</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>/</span></span><span style='color:#000000'><span class='ectt-1000'>tmp</span></span><span style='color:#000000'><span class='ectt-1000'>/</span></span><span style='color:#000000'><span class='ectt-1000'>ping</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>txt</span></span></div>
     
     <!-- l. 291 --><p class='noindent'>Use a payload size similar to the chunk size (in bytes) that you expect to use in
     your experiments.
     </p></li>
<li class='enumerate' id='x1-7006x2'>Compute the expected (considering that the RTT should double the) latency to
     the host of your interlocutor:<br class='newline' /><br class='newline' /><span class='obeylines-h'><span class='verb'><span class='ectt-1000'>export LC\_NUMERIC=en\_US.UTF-8 # Use "." instead of "," for the decimal separator</span></span></span><br class='newline' /><span class='ectt-1000'>grep from &lt; /tmp/ping.txt | cut -f 4 -d "=" | cut -f 1 -d " " |
                                                                  

                                                                  
     </span><span class='ectt-1000'>awk </span><span class='tctt-1000'>'</span><span class='ectt-1000'>{print $1/2}</span><span class='tctt-1000'>'</span><span class='ectt-1000'> &gt; /tmp/localhost_latencies.txt</span><br class='newline' /><br class='newline' />
     </li>
<li class='enumerate' id='x1-7008x3'>
     <!-- l. 299 --><p class='noindent'>Find the histogram of the expected latencies:
</p>
     <!-- l. 301 -->
     <div class='lstlisting' id='listing-3'><span class='label'><a id='x1-7009r2'></a></span><span style='color:#000000'><span class='ectt-1000'>cat</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;&lt;</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>EOF</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>python</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>-</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7010r3'></a></span><span style='color:#000000'><span class='ectt-1000'>import</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>numpy</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>as</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7011r4'></a></span><span style='color:#000000'><span class='ectt-1000'>from</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>scipy</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>import</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>stats</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7012r5'></a></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>loadtxt</span></span><span style='color:#000000'><span class='ectt-1000'>("/</span></span><span style='color:#000000'><span class='ectt-1000'>tmp</span></span><span style='color:#000000'><span class='ectt-1000'>/</span></span><span style='color:#000000'><span class='ectt-1000'>localhost_latencies</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>txt</span></span><span style='color:#000000'><span class='ectt-1000'>")</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7013r6'></a></span><span style='color:#000000'><span class='ectt-1000'>average_latency</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>average</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7014r7'></a></span><span style='color:#000000'><span class='ectt-1000'>print</span></span><span style='color:#000000'><span class='ectt-1000'>("\</span></span><span style='color:#000000'><span class='ectt-1000'>naverage</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>latency</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=",</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>average_latency</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7015r8'></a></span><span style='color:#000000'><span class='ectt-1000'>max_latency</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>max</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7016r9'></a></span><span style='color:#000000'><span class='ectt-1000'>min_latency</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>min</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7017r10'></a></span><span style='color:#000000'><span class='ectt-1000'>maximum_absolute_deviation</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>max</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>max_latency</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>-</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>average_latency</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>average_latency</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>-</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>min_latency</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7018r11'></a></span><span style='color:#000000'><span class='ectt-1000'>print</span></span><span style='color:#000000'><span class='ectt-1000'>("</span></span><span style='color:#000000'><span class='ectt-1000'>maximum</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>absolute</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>deviation</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>jitter</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=",</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>maximum_absolute_deviation</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7019r12'></a></span><span style='color:#000000'><span class='ectt-1000'>correlation_coefficient</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>stats</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>pearsonr</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>roll</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'>,</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>1))[0]</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7020r13'></a></span><span style='color:#000000'><span class='ectt-1000'>print</span></span><span style='color:#000000'><span class='ectt-1000'>("</span></span><span style='color:#000000'><span class='ectt-1000'>Pearson</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>correlation</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>coefficient</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=",</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>correlation_coefficient</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7021r14'></a></span><span style='color:#000000'><span class='ectt-1000'>if</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>correlation_coefficient</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>0:</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7022r15'></a></span><span class='ectt-1000'>  </span><span style='color:#000000'><span class='ectt-1000'>print</span></span><span style='color:#000000'><span class='ectt-1000'>("</span></span><span style='color:#000000'><span class='ectt-1000'>Correlation</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>coefficient</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>0:</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>use</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>0</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>no</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>correlation</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>between</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>RTT</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>samples</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>in</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>your</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>experiments</span></span><span style='color:#000000'><span class='ectt-1000'>")</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7023r16'></a></span><span style='color:#000000'><span class='ectt-1000'>histogram</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>=</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>histogram</span></span><span style='color:#000000'><span class='ectt-1000'>(</span></span><span style='color:#000000'><span class='ectt-1000'>latencies</span></span><span style='color:#000000'><span class='ectt-1000'>)</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7024r17'></a></span><span style='color:#000000'><span class='ectt-1000'>np</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>savetxt</span></span><span style='color:#000000'><span class='ectt-1000'>("/</span></span><span style='color:#000000'><span class='ectt-1000'>tmp</span></span><span style='color:#000000'><span class='ectt-1000'>/</span></span><span style='color:#000000'><span class='ectt-1000'>localhost_histogram</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>txt</span></span><span style='color:#000000'><span class='ectt-1000'>",</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>histogram</span></span><span style='color:#000000'><span class='ectt-1000'>[0])</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7025r18'></a></span><span style='color:#000000'><span class='ectt-1000'>EOF</span></span></div>
     
     </li>
<li class='enumerate' id='x1-7027x4'>
     <!-- l. 321 --><p class='noindent'>Plot the histogram: </p><!-- l. 322 -->
     <div class='lstlisting' id='listing-4'><span class='label'><a id='x1-7028r19'></a></span><span style='color:#000000'><span class='ectt-1000'>gnuplot</span></span><span class='ectt-1000'> </span><br /> 
<span class='label'><a id='x1-7029r20'></a></span><span style='color:#000000'><span class='ectt-1000'>plot</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>"/</span></span><span style='color:#000000'><span class='ectt-1000'>tmp</span></span><span style='color:#000000'><span class='ectt-1000'>/</span></span><span style='color:#000000'><span class='ectt-1000'>localhost_histogram</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>txt</span></span><span style='color:#000000'><span class='ectt-1000'>"</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>with</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>histogram</span></span></div>
     
     </li>
<li class='enumerate' id='x1-7031x5'>Characterize statistically the latency: Which statistical distribution is closer to
     your experimental results?</li></ol>
<!-- l. 331 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead'><span class='titlemark'>3.2.2   </span> <a id='x1-80003.2.2'></a>In the Internet</h5>
<!-- l. 333 --><p class='noindent'>This scenario can be useful to test InterCom in your host, but
simulating later a real connection between hosts in different local
networks<span class='footnote-mark'><a href='#fn8x0' id='fn8x0-bk'><sup class='textsuperscript'>8</sup></a></span><a id='x1-8001f8'></a>.
For doing that:
</p><!-- l. 339 --><p class='indent'>
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-8003x1'>
     <!-- l. 341 --><p class='noindent'>Repeat<span class='footnote-mark'><a href='#fn9x0' id='fn9x0-bk'><sup class='textsuperscript'>9</sup></a></span><a id='x1-8004f9'></a>
     the previous experiment (the characterization of the latencies returned by
     the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> tool) but using your interlocutor’s <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>&lt;router_public_IP_address&gt;</span></span></span>
     instead of <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>localhost</span></span></span>. Let us consider the generated file as <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>/tmp/&lt;router_public_IP_address&gt;_latencies.txt</span></span></span>.
     The IPv4 address of your router can be determined with:
                                                                  

                                                                  
</p>
     <!-- l. 349 -->
     <div class='lstlisting' id='listing-5'><span class='label'><a id='x1-8005r21'></a></span><span style='color:#000000'><span class='ectt-1000'>curl</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>ipecho</span></span><span style='color:#000000'><span class='ectt-1000'>.</span></span><span style='color:#000000'><span class='ectt-1000'>net</span></span><span style='color:#000000'><span class='ectt-1000'>/</span></span><span style='color:#000000'><span class='ectt-1000'>plain</span></span></div>
     
     </li>
<li class='enumerate' id='x1-8007x2'>
     <!-- l. 353 --><p class='noindent'>Request to your interlocutor to ping its router from his/her private network, for example,
     using<span class='footnote-mark'><a href='#fn10x0' id='fn10x0-bk'><sup class='textsuperscript'>10</sup></a></span><a id='x1-8008f10'></a>:
</p>
     <!-- l. 357 -->
     <div class='lstlisting' id='listing-6'><span class='label'><a id='x1-8009r22'></a></span><span style='color:#000000'><span class='ectt-1000'>ping</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>-</span></span><span style='color:#000000'><span class='ectt-1000'>s</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>chunk_length_in_bytes</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>192.168.1.1</span></span></div>
     
     <!-- l. 361 --><p class='noindent'>and to send these data to you. Save this info in
     <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>/tmp/&lt;router_private_IP_address&gt;_latencies.txt</span></span></span>.
     </p></li>
<li class='enumerate' id='x1-8011x3'>
     <!-- l. 364 --><p class='noindent'>Supposing that the latencies are symmetric (the direction of the packes does
     not affect the latency) and that the overall network latency of the link between
     you a your interlocutor is the sum of the latency from your host to the
     router of your interlocutor added to the latency from your interlocutor’s
     host to that router (remember to edit the next line to use the right
     namefiles):
     </p><!-- l. 372 --><p class='noindent'><span class='ectt-1000'>paste /tmp/&lt;router_public_IP_address&gt;_latencies.txt
     </span><span class='ectt-1000'>/tmp/&lt;router_private_IP_address&gt;_latencies.txt | awk </span><span class='tctt-1000'>'</span><span class='ectt-1000'>{print
     </span><span class='ectt-1000'>$1+$2}</span><span class='tctt-1000'>'</span><span class='ectt-1000'> &gt; /tmp/add.txt</span><br class='newline' />
     </p><!-- l. 378 --><p class='noindent'>and, as in the previous experiment, find a characterization for the complete link
     of the data in <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>/tmp/add.txt</span></span></span>: <a href='https://en.wikipedia.org/wiki/Average'>average</a> (arithmetic mean) latency, <a href='https://en.wikipedia.org/wiki/Jitter'>jitter</a>, <a href='https://en.wikipedia.org/wiki/Pearson_correlation_coefficient'>Pearson
     correlation coefficient</a>, and <a href='https://en.wikipedia.org/wiki/List_of_probability_distributions'>probability distribution</a>.
</p>
     </li></ol>
<!-- l. 389 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>3.3   </span> <a id='x1-90003.3'></a>Quantification of the QoE</h4>
<!-- l. 391 --><p class='noindent'>Let us measure the QoE using the following classification: </p>
                                                                  

                                                                  
     <ul class='itemize1'>
     <li class='itemize'><span class='ecbx-1000'>Perfect</span>: no loss or delay can be perceived.
     </li>
     <li class='itemize'><span class='ecbx-1000'>Good</span>: if you detect some minimal distortion in the rendering of the sound.
     </li>
     <li class='itemize'><span class='ecbx-1000'>Acceptable</span>: when the effects of the latency are noticeable, but you can
     communicate with your interlocutor.
     </li>
     <li class='itemize'><span class='ecbx-1000'>Bad</span>: you are able to recognize only small parts of the received audio.
     </li>
     <li class='itemize'><span class='ecbx-1000'>No way</span>: when most of the time only silence is heard.</li></ul>
<!-- l. 403 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead'><span class='titlemark'>3.3.1   </span> <a id='x1-100003.3.1'></a>In your host</h5>
<!-- l. 405 --><p class='noindent'>Simply quantify your QoE when you run InterCom in your host without any traffic
control.
</p><!-- l. 408 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead'><span class='titlemark'>3.3.2   </span> <a id='x1-110003.3.2'></a>In the Internet</h5>
<!-- l. 410 --><p class='noindent'>Quantify your QoE when you run InterCom in two different hosts that are connected to
different<span class='footnote-mark'><a href='#fn11x0' id='fn11x0-bk'><sup class='textsuperscript'>11</sup></a></span><a id='x1-11001f11'></a>
LANs, without any traffic control.
</p><!-- l. 415 --><p class='noindent'>
</p>
   <h5 class='subsubsectionHead'><span class='titlemark'>3.3.3   </span> <a id='x1-120003.3.3'></a>In your host, but simulating the Internet</h5>
<!-- l. 417 --><p class='noindent'>
                                                                  

                                                                  
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-12002x1'>
     <!-- l. 419 --><p class='noindent'>Check the current configuration:
</p>
     <!-- l. 421 -->
     <div class='lstlisting' id='listing-7'><span class='label'><a id='x1-12003r23'></a></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>show</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span></div>
     
     <!-- l. 425 --><p class='noindent'>The output should be something like: “<span class='ectt-1000'>qdisc noqueue 0: root refcnt
     </span><span class='ectt-1000'>2</span>”
     </p></li>
<li class='enumerate' id='x1-12005x2'>
     <!-- l. 428 --><p class='noindent'>Using the characterization of the Internet link previously obtained, use the
     command <a href='https://man7.org/linux/man-pages/man8/tc.8.html'><span class='ectt-1000'>tc</span></a> to simulate this link locally using <a href='https://man7.org/linux/man-pages/man8/tc-netem.8.html'>netem</a>:
</p>
     <!-- l. 434 -->
     <div class='lstlisting' id='listing-8'><span class='label'><a id='x1-12006r24'></a></span><span style='color:#000000'><span class='ectt-1000'>sudo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>add</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>root</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>netem</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>delay</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>average_delay_in_miliseconds</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>maximum_average_deviation_in_miliseconds</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>Pearson_correlation_coefficient_expressed_as_a_percentage</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;%</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>distribution</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>uniform</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>normal</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>pareto</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>paretonormal</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span></div>
     
     <!-- l. 437 --><p class='noindent'>where:
         </p><dl class='description'><dt class='description'>
         <!-- l. 439 --><p class='noindent'>
     <span class='ectt-1000'>qdisc</span><span class='ecbx-1000'>:</span> </p></dt><dd class='description'>
         <!-- l. 439 --><p class='noindent'>Use the default <a href='https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)'>FIFO</a> <a href='https://wiki.debian.org/TrafficControl'>Queueing DISCipline</a> for the outgoing traffic.
         </p></dd><dt class='description'>
         <!-- l. 443 --><p class='noindent'>
     <span class='ectt-1000'>add</span><span class='ecbx-1000'>:</span> </p></dt><dd class='description'>
         <!-- l. 443 --><p class='noindent'>Add a new traffic control rule.
         </p></dd><dt class='description'>
         <!-- l. 444 --><p class='noindent'>
     <span class='ectt-1000'>dev lo</span><span class='ecbx-1000'>:</span> </p></dt><dd class='description'>
         <!-- l. 444 --><p class='noindent'>The device affected by the rule. <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>lo</span></span></span> means <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>loopback</span></span></span>.
         </p></dd><dt class='description'>
         <!-- l. 446 --><p class='noindent'>
     <span class='ectt-1000'>root</span><span class='ecbx-1000'>:</span> </p></dt><dd class='description'>
         <!-- l. 446 --><p class='noindent'>The rule will be applied to all the outbound traffic (it’s the root rule
         of the possible tree of rules).
                                                                  

                                                                  
         </p></dd><dt class='description'>
         <!-- l. 448 --><p class='noindent'>
     <span class='ectt-1000'>netem</span><span class='ecbx-1000'>:</span> </p></dt><dd class='description'>
         <!-- l. 448 --><p class='noindent'>Use the <a href='https://wiki.linuxfoundation.org/networking/netem'>network emulator</a> to emulate a <a href='https://en.wikipedia.org/wiki/Wide_area_network'>WAN</a>.</p></dd></dl>
     <!-- l. 454 --><p class='noindent'>Example:
     </p><!-- l. 456 --><p class='noindent'>
         </p><ol class='enumerate2'>
<li class='enumerate' id='x1-12008x1'>
         <!-- l. 457 --><p class='noindent'>Add the following rule:
</p>
         <!-- l. 459 -->
         <div class='lstlisting' id='listing-9'><span class='label'><a id='x1-12009r25'></a></span><span style='color:#000000'><span class='ectt-1000'>sudo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>add</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>root</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>netem</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>delay</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>100</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>10</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>25%</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>distribution</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>normal</span></span></div>
         
         </li>
<li class='enumerate' id='x1-12011x2'>
         <!-- l. 463 --><p class='noindent'>Check that the rule has been installed with the command:
</p>
         <!-- l. 465 -->
         <div class='lstlisting' id='listing-10'><span class='label'><a id='x1-12012r26'></a></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>show</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span></div>
         
         <!-- l. 469 --><p class='noindent'>that should output (or something very similar): “  <span class='ectt-1000'>qdisc netem 8009:
         </span><span class='ectt-1000'>root refcnt 2 limit 1000 delay 100ms 10ms 25%</span>”</p></li></ol>
     </li>
<li class='enumerate' id='x1-12014x3'>Measure QoE.
     </li>
<li class='enumerate' id='x1-12016x4'>
     <!-- l. 475 --><p class='noindent'>Delete the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>tc</span></span></span> rule with:
</p>
     <!-- l. 477 -->
     <div class='lstlisting' id='listing-11'><span class='label'><a id='x1-12017r27'></a></span><span style='color:#000000'><span class='ectt-1000'>sudo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>delete</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>root</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>netem</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>delay</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>average_dalay_in_miliseconds</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>maximum_average_deviation_in_miliseconds</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>Pearson_correlation_coefficient_expressed_as_a_percentage</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;%</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>distribution</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>uniform</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>normal</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>pareto</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>paretonormal</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span></div>
     
                                                                  

                                                                  
     </li>
<li class='enumerate' id='x1-12019x5'>
     <!-- l. 481 --><p class='noindent'>(Optional) It is possible to change a working rule with:
</p>
     <!-- l. 483 -->
     <div class='lstlisting' id='listing-12'><span class='label'><a id='x1-12020r28'></a></span><span style='color:#000000'><span class='ectt-1000'>sudo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>change</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>root</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>netem</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>delay</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>average_dalay_in_miliseconds</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>maximum_average_deviation_in_miliseconds</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span><span style='color:#000000'><span class='ectt-1000'>ms</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>Pearson_correlation_coefficient_expressed_as_a_percentage</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;%</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>distribution</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>&lt;</span></span><span style='color:#000000'><span class='ectt-1000'>uniform</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>normal</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>pareto</span></span><span style='color:#000000'><span class='ectt-1000'>|</span></span><span style='color:#000000'><span class='ectt-1000'>paretonormal</span></span><span style='color:#000000'><span class='ectt-1000'>&gt;</span></span></div>
     
     </li></ol>
<!-- l. 489 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>3.4   </span> <a id='x1-130003.4'></a>(Optional) QoE considering the packet loss</h4>
<!-- l. 491 --><p class='noindent'>For our application, InterCom, a chunk is lost when it arrives too late or
never arrives. Therefore, the results of a packet loss or delay are almost
indistinguishable<span class='footnote-mark'><a href='#fn12x0' id='fn12x0-bk'><sup class='textsuperscript'>12</sup></a></span><a id='x1-13001f12'></a>.
For example, a packet loss ratio of \(10\%\) can be configured with <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>tc</span></span></span> by running:
</p>
   <!-- l. 497 -->
   <div class='lstlisting' id='listing-13'><span class='label'><a id='x1-13002r29'></a></span><span style='color:#000000'><span class='ectt-1000'>sudo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>tc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>qdisc</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>add</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>dev</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>lo</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>root</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>netem</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>loss</span></span><span style='color:#000000'><span class='ectt-1000'> </span></span><span style='color:#000000'><span class='ectt-1000'>10%</span></span></div>
   
<!-- l. 501 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>3.5   </span> <a id='x1-140003.5'></a>Control of the buffer size in InterCom</h4>
<!-- l. 503 --><p class='noindent'><span class='obeylines-h'><span class='verb'><span class='ectt-1000'>buffer.py</span></span></span> can be run to intercommunicate two users (or one user in
the case of a simulation), and the buffering time (in miliseconds) can
be controlled with the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>--buffering_time</span></span></span> parameter. Using a real o a
simulated environment, find the minimum buffering time that allows you to
hide<span class='footnote-mark'><a href='#fn13x0' id='fn13x0-bk'><sup class='textsuperscript'>13</sup></a></span><a id='x1-14001f13'></a>
the jitter in your environment. If you are using a simulated one, find such a minimal
buffering time in different jitter configurations (value, correlation, and distribution).
Experiment also with the loss of chunks to listen to the effect of playing the empty
chunks.
</p><!-- l. 513 --><p class='noindent'>
</p>
   <h4 class='subsectionHead'><span class='titlemark'>3.6   </span> <a id='x1-150003.6'></a>Create the <span class='ectt-1000'>NAT_Traversal </span>module</h4>
                                                                  

                                                                  
<!-- l. 515 --><p class='noindent'>Finally, remember that the class <span class='ectt-1000'>Buffering </span>in InterCom should inherit
<span class='ectt-1000'>NAT_Traversal </span>instead of <span class='ectt-1000'>Minimal</span>.
   </p><div class='thebibliography'>
   <p class='bibitem'><span class='biblabel'>
 [1]<span class='bibsp'>   </span></span><a id='Xdordal2020intro'></a>Peter L. Dordal. <a href='http://intronetworks.cs.luc.edu/current/ComputerNetworks.pdf'><span class='ecti-1000'>An Introduction to Computer Networks</span></a>. 2020.
   </p>
   <p class='bibitem'><span class='biblabel'>
 [2]<span class='bibsp'>   </span></span><a id='XForouzan'></a>Behrouz   Forouzan.      <a href='https://github.com/aboelkassem/References_Books/blob/master/Data%20Communications%20and%20Networking%20By%20Behrouz%20A.Forouzan.pdf'><span class='ecti-1000'>Introduction  to  Data  Communications  and
   </span><span class='ecti-1000'>Networking</span></a>. McGraw-Hill, 2007.
   </p>
   <p class='bibitem'><span class='biblabel'>
 [3]<span class='bibsp'>   </span></span><a id='Xbert2012lartc'></a>Bert Hubert, Thomas Graf, Greg Maxwell, Remco van Mook, Martijn
   van Oosterhout, Paul B. Schroeder, Jasper Spaans, and Pedro Larroy. <a href='https://lartc.org/'><span class='ecti-1000'>Linux
   </span><span class='ecti-1000'>Advanced Routing &amp; Traffic Control</span></a>. Publisher: Bert Humbert et al., 2012.
   </p>
   <p class='bibitem'><span class='biblabel'>
 [4]<span class='bibsp'>   </span></span><a id='XKurose-Ross'></a>James F.  Kurose  and  Keith W.  Ross.     <a href='https://docs.google.com/viewer?a=v&amp;pid=sites&amp;srcid=Z2FyZGl2aWR5YXBpdGguYWMuaW58aXQyMDE0LTIwMTh8Z3g6OTY5ZDcxZjRmZDBkYzI3'><span class='ecti-1000'>Computer  Networking:  A
   </span><span class='ecti-1000'>Top-Down Approach Featuring the Internet</span></a>. Pearson, 2013.
   </p>
   <p class='bibitem'><span class='biblabel'>
 [5]<span class='bibsp'>   </span></span><a id='Xsrisuresh1999nat'></a>P. Srisuresh and M. Holdrege.  <a href='https://tools.ietf.org/html/rfc2663'>IP Network Address Translator (NAT)
   Terminology and Considerations (RFC 2663)</a>. 1999.
   </p>
   <p class='bibitem'><span class='biblabel'>
 [6]<span class='bibsp'>   </span></span>
   <a id='XStallings'></a>William Stallings. <a href='https://memberfiles.freewebs.com/00/88/103568800/documents/Data.And.Computer.Communications.8e.WilliamStallings.pdf'><span class='ecti-1000'>Data and Computer Communications</span></a>. Pearson/Prentice
   Hall, 2007.
   </p>
   <p class='bibitem'><span class='biblabel'>
 [7]<span class='bibsp'>   </span></span><a id='XTanenbaum'></a>Andrew S. Tanenbaum. <a href='https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwj9857DgLvsAhUTA2MBHTJfCZ4QFjAAegQIBBAC&amp;url=https%3A%2F%2Fdocs.google.com%2Fviewer%3Fa%3Dv%26pid%3Dsites%26srcid%3DZGVmYXVsdGRvbWFpbnxza21pbmh8Z3g6NjQxMTI2MmYxMTAwZmNjZQ&amp;usg=AOvVaw3m5WEH7H2923_hOFl1e-W-'><span class='ecti-1000'>Computer Networks</span></a>. Prentice Hall, 2011.
</p>
   </div>
<p><a id='Q1-1-20'></a></p>
                                                                  

                                                                  
   <div class='footnotes'><!-- l. 34 --><p class='indent'>     <span class='footnote-mark'><a href='#fn1x0-bk' id='fn1x0'><sup class='textsuperscript'>1</sup></a></span><span class='ecrm-0800'>Something that is not available to normal network users.</span></p>
<!-- l. 62 --><p class='indent'>     <span class='footnote-mark'><a href='#fn2x0-bk' id='fn2x0'><sup class='textsuperscript'>2</sup></a></span><span class='ecrm-0800'>Usually implemented with random access buffers.</span></p>
<!-- l. 74 --><p class='indent'>     <span class='footnote-mark'><a href='#fn3x0-bk' id='fn3x0'><sup class='textsuperscript'>3</sup></a></span><span class='ecrm-0800'>Implementation tip: in a system where for each recorded chunk a chunk must be
</span><span class='ecrm-0800'>also played, a delay in the playback can be generated by sending zero-chunks to the
</span><span class='ecrm-0800'>DAC and then, after the delay, start sending the received chunk of audio, in the right
</span><span class='ecrm-0800'>order.</span></p>
<!-- l. 125 --><p class='noindent'><span class='footnote-mark'><a href='#fn4x0-bk' id='fn4x0'><sup class='textsuperscript'>4</sup></a></span><span class='ecrm-0800'>Those chunks that have not been received on time or never have been received.</span></p><!-- l. 163 --><p class='indent'> <span class='footnote-mark'><a href='#fn5x0-bk' id='fn5x0'><sup class='textsuperscript'>5</sup></a></span><span class='ecrm-0800'>Chunks will be compressed in a posterior milestone, and uncompressing is performed in this
</span><span class='ecrm-0800'>step.</span></p>
<!-- l. 200 --><p class='noindent'><span class='footnote-mark'><a href='#fn6x0-bk' id='fn6x0'><sup class='textsuperscript'>6</sup></a></span><span class='ecrm-0800'>In the general case, we can use two instances but it is also possible to use only one.</span></p>
<!-- l. 228 --><p class='noindent'><span class='footnote-mark'><a href='#fn7x0-bk' id='fn7x0'><sup class='textsuperscript'>7</sup></a></span><span class='ecrm-0800'>In other OS, other tools could be avaiable. If this is not the case, remember that we can
</span><span class='ecrm-0800'>run InterCom in a virtual machine to control the network latency.</span></p>
<!-- l. 337 --><p class='indent'>     <span class='footnote-mark'><a href='#fn8x0-bk' id='fn8x0'><sup class='textsuperscript'>8</sup></a></span><span class='ecrm-0800'>If you are unable to use two different local networks, try to run InterCom in two hosts
</span><span class='ecrm-0800'>connected to the same router.</span></p>
<!-- l. 342 --><p class='noindent'><span class='footnote-mark'><a href='#fn9x0-bk' id='fn9x0'><sup class='textsuperscript'>9</sup></a></span><span class='ecrm-0800'>Remember that the data files must be processed to extract the latencies.</span></p>
<!-- l. 355 --><p class='noindent'><span class='footnote-mark'><a href='#fn10x0-bk' id='fn10x0'><sup class='textsuperscript'>10</sup></a></span><span class='ecrm-0800'>Notice that the private IP addres of your router could be different.</span></p>
<!-- l. 413 --><p class='indent'>     <span class='footnote-mark'><a href='#fn11x0-bk' id='fn11x0'><sup class='textsuperscript'>11</sup></a></span><span class='ecrm-0800'>If you are unable to use two different LANs, try to run InterCom in two hosts connected to
</span><span class='ecrm-0800'>the same router.</span></p>
<!-- l. 494 --><p class='indent'>     <span class='footnote-mark'><a href='#fn12x0-bk' id='fn12x0'><sup class='textsuperscript'>12</sup></a></span><span class='ecrm-0800'>Except by the average latency experimented by the user (the higher the network latency, the
</span><span class='ecrm-0800'>higher the perceived latency).</span></p>
<!-- l. 507 --><p class='indent'>     <span class='footnote-mark'><a href='#fn13x0-bk' id='fn13x0'><sup class='textsuperscript'>13</sup></a></span><span class='ecrm-0800'>Allowing a good quality of the sound.</span></p>                                                              </div>
 
</body> 
</html>