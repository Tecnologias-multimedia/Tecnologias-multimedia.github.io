<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" 
"http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd" > 
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Tecnolog&#x00C3;&#x014B;as Multimedia - Study Guide - Milestone 8: Bu&#xFB00;ering for hidding the
jitter</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- xhtml,mathml,html --> 
<meta name="src" content="index.tex" /> 
<link rel="stylesheet" type="text/css" href="index.css" /> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead"><a 
href="https://www.ual.es/estudios/grados/presentacion/plandeestudios/asignatura/4015/40154321?idioma=zh_CN" >Tecnolog&#x00ED;as Multimedia</a> - Study Guide -
Milestone 8: Bu&#xFB00;ering for hidding the jitter</h2>
 <div class="author" ><a 
href="https://cms.ual.es/UAL/personas/persona.htm?id=515256515553484875" ><span 
class="ecrm-1200">Vicente Gonz</span><span 
class="ecrm-1200">&#x00E1;</span><span 
class="ecrm-1200">lez Ruiz</span></a> <span 
class="ecrm-1200">- </span><a 
href="https://cms.ual.es/UAL/universidad/departamentos/informatica/index.htm" ><span 
class="ecrm-1200">Depto Inform</span><span 
class="ecrm-1200">&#x00E1;</span><span 
class="ecrm-1200">tica</span></a> <span 
class="ecrm-1200">- </span><a 
href="https://www.ual.es" ><span 
class="ecrm-1200">UAL</span></a></div><br />
<div class="date" ><span 
class="ecrm-1200">September 5, 2021</span></div>
   </div>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>Description</h3>
<!--l. 8--><p class="noindent" >As we have determined in the previous milestones, we can consider that the QoE
provided by InterCom is inversely proportional to the network jitter &#x0028;see Fig.&#x00A0;<a 
href="#x1-1001r1">1<!--tex4ht:ref: fig:timelines --></a>-a&#x0029;.
One solution &#x0028;see Fig.&#x00A0;<a 
href="#x1-1001r1">1<!--tex4ht:ref: fig:timelines --></a>-b&#x0029; to this drawback is the use of a <a 
href="https://en.wikipedia.org/wiki/Random_access" >random access</a> <a 
href="https://en.wikipedia.org/wiki/Data_buffer" >bu&#xFB00;er</a> at
the receiver side, where the chunks are stored for a time large enough to hidde the
jitter to the user&#x00A0;<span class="cite">&#x005B;<a 
href="#XKurose-Ross">1</a>&#x005D;</span>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
                                                                  

                                                                  
<div class="center" 
>
<!--l. 18--><p class="noindent" >
</p><!--l. 19--><p class="noindent" ><div style="text-align:center;"> <img width=1000 src="graphics/timelines.svg" /> </div>  </p></div>
<a 
 id="x1-1001r1"></a>
<a 
 id="x1-1002"></a>
<br />                                                                  <div class="caption" 
><span class="id">
Figure&#x00A0;1: </span><span  
class="content">Timelines of two InterCom interactions. On the left, the playback is
defective because some chunks are lost. On the right, the audio rendering is
correct because the playback has been delayed 2 chunk times &#x0028;enough for this
example&#x0029;.
</span></div><!--tex4ht:label?: x1-1001r1 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 29--><p class="indent" >   <a 
href="https://en.wikipedia.org/wiki/Jitter#Jitter_buffers" ><span 
class="ecti-1000">Dejitterizing </span>bu&#xFB00;ers</a> are typically implemented with a circular bu&#xFB00;er structure
&#x0028;see Fig.&#x00A0;<a 
href="#x1-1004r2">2<!--tex4ht:ref: fig:circular_buffer --></a>&#x0029;. In an ideal situation &#x0028;as the depicted in the &#xFB01;gure&#x0029;, the number of
pending-to-be-played chunks available in the bu&#xFB00;er is half of the number of cells in
the bu&#xFB00;er, and the chunks have arrived on time. In this example, the receiver &#x0028;where
the chunks are bu&#xFB00;ered&#x0029; waits for 3 chunks before to start playing the chunk number
0.<span class="footnote-mark"><a 
href="index2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-1003f1"></a>  Notice that the number
of cells in the bu&#xFB00;er <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>2</mn><mi 
>N</mi></math>
must be the double of the number of the chunks bu&#xFB00;ered during the bu&#xFB00;ering time
<!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>, in order
to hide a <!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>
chunk-time jitter. Notice also that this technique introduces also a
<!--l. 42--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>
chunk-times delay in the playback.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-2" class="tabular" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /><col 
id="TBL-2-3" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="text-align:center; white-space:nowrap;" id="TBL-2-1-1"  
class="td11"> <!--l. 47--><p class="noindent" ><div style="text-align:center;"> <img width=200 src="graphics/circular_buffer1.svg" /> </div>                                                                    </p></td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-1-2"  
class="td11"> <!--l. 47--><p class="noindent" ><div style="text-align:center;"> <img width=200 src="graphics/circular_buffer2.svg" /> </div>                                                                    </p></td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-1-3"  
class="td11"> <!--l. 47--><p class="noindent" ><div style="text-align:center;"> <img width=200 src="graphics/circular_buffer3.svg" /> </div>                                                                    </p></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="text-align:center; white-space:nowrap;" id="TBL-2-2-1"  
class="td11">                                 &#x0028;a&#x0029;                                                    </td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-2-2"  
class="td11">                                 &#x0028;b&#x0029;                                                    </td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-2-3"  
class="td11">                                 &#x0028;c&#x0029;                                                    </td></tr></table>
</div> <a 
 id="x1-1004r2"></a>
<a 
 id="x1-1005"></a>
<br />                                                                  <div class="caption" 
><span class="id">
Figure&#x00A0;2: </span><span  
class="content">A circular bu&#xFB00;er with 6 cells &#x0028;space for 6 chunks&#x0029;. Up to the half
of the bu&#xFB00;er is occupied &#x0028;cells in gray&#x0029; because the bu&#xFB00;ering time is 3 chunk
times and 3 chunks &#x0028;with chunk number 0, 1 and 2 in the beginning, sub&#xFB01;gure
&#x0028;a&#x0029;&#x0029; have been received. The &#xFB01;rst chunk to be played is chunk 0 &#x0028;sub&#xFB01;gure &#x0028;b&#x0029;&#x0029;.
Then, a new chunk &#x0028;chunk number 3&#x0029; is received and bu&#xFB00;ered &#x0028;sub&#xFB01;gure &#x0028;c&#x0029;&#x0029;.
</span></div><!--tex4ht:label?: x1-1004r1 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 59--><p class="indent" >   For this new improved InterCom a parameter with the <span 
class="ecti-1000">bu&#xFB00;ering time </span>must be
provided by the users. This value &#x0028;typically expressed in miliseconds&#x0029; should be large
enough to hide the network jitter, but small enough to minimize the end-to-end
&#x0028;user&#x0029; latency.
</p><!--l. 64--><p class="indent" >   The following guidelines have been used to implement the <span 
class="ecti-1000">bu&#xFB00;ered </span>version of
InterCom:
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-1007x1">The  class  Minimal  &#x0028;<a 
href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)" >inherit</a>  from&#x0029;  has  been  inherited  &#x0028;extended&#x0029;  to
     implement a new class Bu&#xFB00;ering.
     </li>
     <li 
  class="enumerate" id="x1-1009x2">In the payload of the UDP packets a chunk number has been included
     in order to provide to the receiver the information to determine where to
     store the corresponding chunk in the circular bu&#xFB00;er. An unsigned integer
     of 16 bits has been used for representing the chunk numbers.
     </li>
     <li 
  class="enumerate" id="x1-1011x3">It has been taken into consideration that the critical part of InterCom &#x0028;the
     method <span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">record_send_and_play&#x0028;&#x0029;</span></span></span>&#x0029; is a method that runs as an <a 
href="https://en.wikipedia.org/wiki/Interrupt_handler" >interrup
     handler</a> that could be called each time a new chunk is available in the ADC &#x0028;see
     the Milestone 4&#x0029;. More precisely:
         <ol  class="enumerate2" >
         <li 
  class="enumerate" id="x1-1013x1">In order to minimize the latency, the recorded chunks are sent to the
         interlocutor as soon as possible.
         </li>
         <li 
  class="enumerate" id="x1-1015x2">The  playback  of  the  chunks  extracted  from  the  bu&#xFB00;er  is  <a 
href="https://en.wikipedia.org/wiki/Gapless_playback" ><span 
class="ecti-1000">gapless</span></a>
         &#x0028;without the ocurrence of silences&#x0029; as long as the chunks have been
         received on time.
         </li>
         <li 
  class="enumerate" id="x1-1017x3">As  always,  the  lost  chunks  are  replaced  by  zero-chunks  in  the
         playback.</li></ol>
     </li>
     <li 
  class="enumerate" id="x1-1019x4">A method <span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">receive_and_buffer&#x0028;&#x0029;</span></span></span> is run now in a di&#xFB00;erent execution <a 
href="https://en.wikipedia.org/wiki/Thread_(computing)" >thread</a>,
     decoupled from the <span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">record_send_and_play&#x0028;&#x0029;</span></span></span> method. But notice that using
     the sounddevice package this is achived without using the <a 
href="https://docs.python.org/3/library/threading.html" >threading</a>
     nor <a 
href="https://docs.python.org/3/library/multiprocessing.html" >multiprocessing</a> packages because the interruption handler &#x0028;the
     so called <span 
class="ecti-1000">callback</span>&#x0028;&#x0029; function&#x0029; already runs in parallel with the main
     thread.</li></ol>
<!--l. 106--><p class="indent" >   This is an overview of the implementation:
</p>
   <!--l. 108-->
                                                                  

                                                                  
   <div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-1020r1"></a></span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">Buffering</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">InterCom</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1021r2"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">def</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">record_send_and_play</span><span 
class="ectt-1000">&#x0028;&#x0029;:</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1022r3"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">chunk</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">=</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">record</span><span 
class="ectt-1000">&#x0028;&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;1&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1023r4"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">packed_chunk</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">=</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">pack</span><span 
class="ectt-1000">&#x0028;</span><span 
class="ectt-1000">chunk</span><span 
class="ectt-1000">&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;2&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1024r5"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">send</span><span 
class="ectt-1000">&#x0028;</span><span 
class="ectt-1000">packed_chunk</span><span 
class="ectt-1000">&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;3&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1025r6"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">chunk</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">=</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">unbuffer_next_chunk</span><span 
class="ectt-1000">&#x0028;&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;4&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1026r7"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">play</span><span 
class="ectt-1000">&#x0028;</span><span 
class="ectt-1000">chunk</span><span 
class="ectt-1000">&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;5&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1027r8"></a></span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1028r9"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">def</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">receive_and_buffer</span><span 
class="ectt-1000">&#x0028;&#x0029;:</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1029r10"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">packed_chunk</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">=</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">receive</span><span 
class="ectt-1000">&#x0028;&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;1&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1030r11"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">chunk_number</span><span 
class="ectt-1000">,</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">chunk</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">=</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">unpack</span><span 
class="ectt-1000">&#x0028;</span><span 
class="ectt-1000">packed_chunk</span><span 
class="ectt-1000">&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;2&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><br /><span class="label"><a 
 id="x1-1031r12"></a></span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">buffer</span><span 
class="ectt-1000">&#x0028;</span><span 
class="ectt-1000">chunk_number</span><span 
class="ectt-1000">,</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ectt-1000">chunk</span><span 
class="ectt-1000">&#x0029;</span><span 
class="ectt-1000">&#x00A0;</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">#</span><span 
class="ecit-1000">&#x00A0;</span><span 
class="ecit-1000">&#x0028;3&#x0029;</span>
   
   </div>
<!--l. 123--><p class="indent" >   Notice that the Step &#x0028;4&#x0029; of the method <span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">record_send_and_play&#x0028;&#x0029;</span></span></span> extractcs from
the bu&#xFB00;er an unpacked chunk. The chunks are bu&#xFB00;ered in the Step &#x0028;3&#x0029; of the method
<span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">receive_and_buffer&#x0028;&#x0029;</span></span></span>.
</p>
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-20002"></a>What do you have to do?</h3>
<!--l. 148--><p class="noindent" >Using the real scenario &#x0028;two hosts in di&#xFB00;erent LANs&#x0029; used in the previous milestone,
execute <span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">buffer.py</span></span></span> to inter-communicate two users. Use the <span class="obeylines-h"><span class="verb"><span 
class="ectt-1000">--buffering_time</span></span></span>
parameter to &#xFB01;nd the minimum delay that provides a good QoS.
</p><!--l. 153--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-30003"></a>Timming</h3>
<!--l. 155--><p class="noindent" >Please, &#xFB01;nish this milestone in one week.
</p><!--l. 157--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-40004"></a>Deliverables</h3>
<!--l. 159--><p class="noindent" >A report explaining your experiment and the corresponding results.
</p><!--l. 161--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-50005"></a>Resources</h3>
   <div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 &#x005B;1&#x005D;<span class="bibsp">&#x00A0;&#x00A0;&#x00A0;</span></span><a 
 id="XKurose-Ross"></a>James&#x00A0;F.  Kurose  and  Keith&#x00A0;W.  Ross.     <a 
href="https://docs.google.com/viewer?a=v&pid=sites&srcid=Z2FyZGl2aWR5YXBpdGguYWMuaW58aXQyMDE0LTIwMTh8Z3g6OTY5ZDcxZjRmZDBkYzI3" ><span 
class="ecti-1000">Computer  Networking:  A</span>
   <span 
class="ecti-1000">Top-Down Approach Featuring the Internet</span></a>. Pearson, 2013.
</p>
   </div>
<a 
 id="Q1-1-6"></a>
    
</body></html> 

                                                                  


