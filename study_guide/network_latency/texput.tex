\title{\TM - Study Guide - Milestone 5: Impact of the Communication Latency}

\maketitle

\section{Description}

\href{https://en.wikipedia.org/wiki/Latency_(engineering)#Communication_latency}{Communication
  latency} (also called
\href{https://en.wikipedia.org/wiki/Network_delay}{network delay} and
\href{https://en.wikipedia.org/wiki/End-to-end_delay}{end-to-end
  delay}) is the time that a piece of data (a
\href{https://en.wikipedia.org/wiki/Network_packet}{packed} in the
case of the Internet) takes to travel from one point of the network to
another. This time is relevant for an intercom because the total latency $t_u$ that an user is going to experiment is
\begin{equation}
  t_u = t_l + t_i,
  \label{eq:user_latency}
\end{equation}
where $t_l$ is the (tele-communication)
\href{https://en.wikipedia.org/wiki/Telecommunications_link}{link}
latency and $t_i$ is the latency generated by the intercom.

Due to the current design of the Internet (where the available
\href{https://en.wikipedia.org/wiki/Bandwidth_(computing)}{bandwidth}
is shared on demand by the users of the network) $t_l$ is
time-variying, and cannot be controlled without using
\href{https://en.wikipedia.org/wiki/Quality_of_service}{Quality of
  Service (QoS)}, something that is not accesible to normal network
users. On the contrary, $t_i$ is constant for a given intercom's
configuration/implementation.

In this milestone we are going to measure the
\href{https://en.wikipedia.org/wiki/Quality_of_experience}{Quality of
  Experience (QoE)} provided by our minimal intercom when the network
latency varies \href{https://en.wikipedia.org/wiki/Randomness}{at
  random}. At this point, we have basically two alternatives:
\begin{enumerate}
\item Run two instances of InterCom in two different hosts separated
  by a shared link.
\item Run one instance of Intercom and simulate the network latency.
\end{enumerate}
Each option has pros and cons, from which we can highlight that:
\begin{enumerate}
\item (Pro) The use of real latency is going to show the definitive
  behaviour of InterCom between the used hosts, which is quite
  impredictable (depend basically of the
  \href{https://en.wikipedia.org/wiki/Network_congestion}{network
    congestion}). (Con) To run InterCom in two different hosts we will
  need to establish a direct communication between them and it is very
  likely that we will have to redirect ports in the corresponding
  \href{https://en.wikipedia.org/wiki/Network_address_translation}{NAT}
  devices~\cite{}.
\item (Pro) The simulation of the link latency is much more
  straightforward than the opening ports in our routers and (pro) will
  allow us to run InterCom in situations that are difficult to achieve
  in a real network. (Con) The running environment must provide a way
  of controlling the latency between
  \href{https://en.wikipedia.org/wiki/Process_(computing)}{processes}. Fortunately,
  in Linux we can control the latency (and the
  \href{https://en.wikipedia.org/wiki/Bit_rate}{bit-rate}) of the
  outgoing (packets) traffic using the command
  \href{https://man7.org/linux/man-pages/man8/tc.8.html}{$\mathtt{tc}$}.
\end{enumerate}

\section{What you have to do?}

\subsection{Characterize the latency in different scenarios}

\subsubsection{In your host}

\subsubsection{In your home network}

\subsubsection{In the Internet}

Let's suppose that at least one of the InterCom users is not able to
redirect ports in his/her router (which implements NAT). In this case:

\begin{enumerate}
\item Ask to your interlocutor the public IP address of the router.
\item Ping the router:
  \begin{lstlisting}{language=bash}
    ping the_IP_address_of_the_router -c 100 > /tmp/ping.dat
  \end{lstlisting}
\item Compute the expected latency to the host of your interlocutor:
  \begin{lstlisting}{language=bash}
    grep from < /tmp/ping.dat | cut -f 4 -d "=" | cut -f 1 -d " " | awk '{print $1/2}' > /tmp/internet.dat
  \end{lstlisting}

\subsection{Measure the QoE of InterCom}

Let's quantify the QoE using the following classification:
\begin{itemize}
\item [Perfect]: no loss or delay can be distinguish.
\item [Good]: if you detect some minimal distortion in the rendering
  of the sound.
\item [Acceptable]: when the effects of the latency are apreciable, but
  you can communicate with your interlocutor.
\item [Bad]: you are able to recognize only small parts of the
  received audio.
\item [No way]: when most of the time only silence is heard.
\end{itemize}

\subsubsection{In your host}

You don't need to control the network traffic in your host because it
is already shapped when InterCom uses the loopback network device.

\begin{enumerate}
  
\item 

\end{enumerate}

\subsubsection{In your home network}

\section{Timming}

There is not time limit for finishing this milestone. Develop it at
your own pace.

\section{Deliverables}

None.

\section{Resources}

\bibliography{python,intercom}
