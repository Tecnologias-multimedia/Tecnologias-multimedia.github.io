\input{../definitions}
\title{\TM - Study Guide - Milestone 6: Buffering for dejitterizing}

\maketitle

\section{Description}

The QoE provided by InterCom is inversely proportional to the
jitter. One solution to this drawback (see the
Fig.~\ref{fig:timelines}) is the use of a random access buffer at the
receiver side, where the chunks are stored for a time large enough to
hidden the jitter to the user.

\begin{figure}
  \begin{center}
    \myfig{graphics/timelines}{10cm}{1000}
  \end{center}
  \caption{Timelines of two sender/receiver interactions. On the left,
    the playback is defective because some chunks are lost. On the
    right, the audio rendering is right because the playback has been
    delayed 2 chunk times.}
  \label{fig:timelines}
\end{figure}

Dejitterizing buffers are typically implemented with a circular buffer
(see the Fig.~\ref{fig:circular_buffer}). The size of the buffer is
the double of the number of the chunks that can stored in the buffer
during the buffering time. In an ideal transmission (without packed
reordering in transit), the chunks in this example have arrived in
order (first the chunk 0, next the chunk 1, and finally, the chunk
2). After the buffering time, the chunk 0 must be played, and after
this, the rest of chunks that will be found in the circular buffer
during the playback of the rest of the stream.

\begin{figure}
  \begin{center}
    \myfig{graphics/circular_buffer}{3cm}{300}
  \end{center}
  \caption{A circular buffer with 6 cells (space for 6 chunks). Half
    of the buffer is occupied because the buffering time is 3 chunk
    times and 3 chunks (with chunk number 0, 1 and 2) have been
    received. The first chunk to be played is chunk 0.}
  \label{fig:circular_buffer}
\end{figure}

For this new improved InterCom the parameter \emph{buffering time}
must be provided by the users. This value (tipycally expressed in
miliseconds) should be large enough to hide the network jitter, but
small enough to minimize the end-to-end (user) latency.

Follow these basic guidelines to implement the \emph{buffered} version
of InterCom:

\begin{enumerate}
\item Extend (inherit from) the class Minimal to implement a new class
  Buffer.
\item In the payload of the UDP packets a chunk number must be
  included in order to provide to the receiver the information to
  decide where to store the corresponding chunk in the circular
  buffer. Use an unsigned integer of 16 bits for representing the
  chunk numbers.
\item Take into account that the critical part of InterCom is a task
  that could be called \emph{record-send-and-play}, and this should be
  iterated each time a new chunk is available in the ADC. More
  precisely:
  \begin{enumerate}
  \item The recorded chunks must be sent to the interlocutor as soon
    as possible in order to minimize the latency.
  \item The playback of the chunks extracted from the buffer must be
    \emph{seamless} (without the ocurrence of silences) as long as the
    chunks have been received on time.
  \item As always, the lost chunks should be replaced by zero-chunks
    in the playback.
  \end{enumerate}
\end{enumerate}

\section{Timming}

Please, finish this milestone in two weeks.

\section{Deliverables}

A python module called \texttt{buffer.py} stored in the root directory
of the intercom's repo.

\section{Resources}

\bibliography{networking}
