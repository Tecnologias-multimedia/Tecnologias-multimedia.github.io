<!DOCTYPE html> 
<html> 
<head> <title>TecnologÃŋas Multimedia- Study Guide - Milestone 6: Buﬀering for dejitterizing</title> 
<meta charset="UTF-8" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<link rel="stylesheet" type="text/css" href="index.css" /> 
<script type="text/javascript" 
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" 
></script> 
<style type="text/css"> 
.MathJax_MathML {text-indent: 0;} 
</style> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead"><a 
href="https://www.ual.es/estudios/grados/presentacion/plandeestudios/asignatura/4015/40154321?idioma=zh_CN" >Tecnologías Multimedia</a>- Study Guide -
Milestone 6: Buﬀering for dejitterizing</h2>
 <div class="author" ><a 
href="https://cms.ual.es/UAL/personas/persona.htm?id=515256515553484875" ><span 
class="ecrm-1200">Vicente Gonz</span><span 
class="ecrm-1200">á</span><span 
class="ecrm-1200">lez Ruiz</span></a> <span 
class="ecrm-1200">- </span><a 
href="https://cms.ual.es/UAL/universidad/departamentos/informatica/index.htm" ><span 
class="ecrm-1200">Depto Inform</span><span 
class="ecrm-1200">á</span><span 
class="ecrm-1200">tica</span></a> <span 
class="ecrm-1200">- </span><a 
href="https://www.ual.es" ><span 
class="ecrm-1200">UAL</span></a></div><br />
<div class="date" ><span 
class="ecrm-1200">October 30, 2020</span></div>
   </div>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>Description</h3>
<!--l. 8--><p class="noindent" >The QoE provided by InterCom is inversely proportional to the network jitter (see
Fig. <a 
href="#x1-1001r1">1<!--tex4ht:ref: fig:timelines --></a>-a). One solution to this drawback (Fig. <a 
href="#x1-1001r1">1<!--tex4ht:ref: fig:timelines --></a>-b) is the use of a <a 
href="https://en.wikipedia.org/wiki/Random_access" >random access</a>
<a 
href="https://en.wikipedia.org/wiki/Data_buffer" >buﬀer</a> at the receiver side, where the chunks are stored for a time large enough to
hidden the jitter to the user <span class="cite">[<a 
href="#XKurose-Ross">1</a>]</span>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
                                                                  

                                                                  
<div class="center" 
>
<!--l. 17--><p class="noindent" >
</p><!--l. 18--><p class="noindent" ><div style="text-align:center;"> <img width=1000 src="graphics/timelines.svg" /> </div>  </p></div>
<a 
 id="x1-1001r1"></a>
<a 
 id="x1-1002"></a>
<br />                                                                  <div class="caption" 
><span class="id">
Figure 1: : </span><span  
class="content">Timelines of two InterCom interactions. On the left, the playback
is defective because some chunks are lost. On the right, the audio rendering is
correct because the playback has been delayed 2 chunk times (enough for this
example).
</span></div><!--tex4ht:label?: x1-1001r1 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 28--><p class="indent" >   <a 
href="https://en.wikipedia.org/wiki/Jitter#Jitter_buffers" ><span 
class="ecti-1000">Dejitterizing </span>buﬀers</a> are typically implemented with a circular buﬀer structure
(see the Fig. <a 
href="#x1-1004r2">2<!--tex4ht:ref: fig:circular_buffer --></a>). In an ideal situation (as the depicted in the ﬁgure), the number of
pending-to-be-played chunks available in the buﬀer is half of the number of cells in
the buﬀer, and the chunks have arrived on time. In this example, the receiver (where
the chunks are buﬀered) waits for 3 chunks before to start playing the chunk number
0.<span class="footnote-mark"><a 
href="index2.html#fn1x0"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-1003f1"></a>  Notice that the number
of cells in the buﬀer <!--l. 39--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>2</mn><mi 
>N</mi></math>
must be the double of the number of the chunks buﬀered during the buﬀering time
<!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>, in order
to hide a <!--l. 40--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>
chunk-time jitter. Notice also that this technique introduces also a
<!--l. 41--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>
chunk-time delay in the playback.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                  

                                                                  
                                                                  

                                                                  
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /><col 
id="TBL-2-3" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="text-align:center; white-space:nowrap;" id="TBL-2-1-1"  
class="td11"> <!--l. 46--><p class="noindent" ><div style="text-align:center;"> <img width=200 src="graphics/circular_buffer1.svg" /> </div>                                                                    </p></td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-1-2"  
class="td11"> <!--l. 46--><p class="noindent" ><div style="text-align:center;"> <img width=200 src="graphics/circular_buffer2.svg" /> </div>                                                                    </p></td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-1-3"  
class="td11"> <!--l. 46--><p class="noindent" ><div style="text-align:center;"> <img width=200 src="graphics/circular_buffer3.svg" /> </div>                                                                    </p></td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="text-align:center; white-space:nowrap;" id="TBL-2-2-1"  
class="td11">                                 (a)                                                    </td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-2-2"  
class="td11">                                 (b)                                                    </td><td  style="text-align:center; white-space:nowrap;" id="TBL-2-2-3"  
class="td11">                                 (c)                                                    </td></tr></table>
</div> <a 
 id="x1-1004r2"></a>
<a 
 id="x1-1005"></a>
<br />                                                                  <div class="caption" 
><span class="id">
Figure 2: : </span><span  
class="content">A circular buﬀer with 6 cells (space for 6 chunks). Up to the half
of the buﬀer is occupied (cells in gray) because the buﬀering time is 3 chunk
times and 3 chunks (with chunk number 0, 1 and 2 in the beginning, subﬁgure
(a)) have been received. The ﬁrst chunk to be played is chunk 0 (subﬁgure (b)).
Then, a new chunk (chunk number 3) is received and buﬀered (subﬁgure (c)).
</span></div><!--tex4ht:label?: x1-1004r1 -->
                                                                  

                                                                  
   </div><hr class="endfigure" />
<!--l. 58--><p class="indent" >   For this new improved InterCom a parameter with the <span 
class="ecti-1000">buﬀering time </span>must be
provided by the users. This value (typically expressed in miliseconds) should be large
enough to hide the network jitter, but small enough to minimize the end-to-end
(user) latency.
</p><!--l. 63--><p class="indent" >   Use the following basic guidelines to implement the <span 
class="ecti-1000">buﬀered </span>version of
InterCom:
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-1007x1">Extend (<a 
href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)" >inherit</a> from) the class <span 
class="ectt-1000">Minimal </span>to implement a new class <span 
class="ectt-1000">Buffer</span>.
     </li>
     <li 
  class="enumerate" id="x1-1009x2">In the payload of the UDP packets a chunk number must be included
     in order to provide to the receiver the information to determine where
     to store the corresponding chunk in the circular buﬀer. Use an unsigned
     integer of 16 bits for representing the chunk numbers.
     </li>
     <li 
  class="enumerate" id="x1-1011x3">Take into account that the critical part of InterCom is a <a 
href="https://en.wikipedia.org/wiki/Task_(computing)" >task</a> that could be
     called <span 
class="ecti-1000">record-send-and-play</span>, and this should be iterated each time a new chunk
     is available in the <a 
href="https://en.wikipedia.org/wiki/Analog-to-digital_converter" >ADC</a>. More precisely:
         <ol  class="enumerate2" >
         <li 
  class="enumerate" id="x1-1013x1">In order to minimize the latency, the recorded chunks must be sent
         to the interlocutor as soon as possible.
         </li>
         <li 
  class="enumerate" id="x1-1015x2">The playback of the chunks extracted from the buﬀer must be <a 
href="https://en.wikipedia.org/wiki/Gapless_playback" ><span 
class="ecti-1000">gapless</span></a>
         (without the ocurrence of silences) as long as the chunks have been
         received on time.
         </li>
         <li 
  class="enumerate" id="x1-1017x3">As always, the lost chunks should be replaced by zero-chunks in the
         playback.</li></ol>
     </li>
     <li 
  class="enumerate" id="x1-1019x4">A <span 
class="ecti-1000">receive-and-buﬀer </span>task can be run now in a diﬀerent execution <a 
href="https://en.wikipedia.org/wiki/Thread_(computing)" >thread</a>,
     decoupled from the <span 
class="ecti-1000">record-send-and-play </span>task. But notice that using
     <span 
class="ectt-1000">sounddevice </span>this can be achived without using the <a 
href="https://docs.python.org/3/library/threading.html" ><span 
class="ectt-1000">threading</span></a> nor
     <a 
href="https://docs.python.org/3/library/multiprocessing.html" ><span 
class="ectt-1000">multiprocessing</span></a> libraries because the interruption handler (the so called
     <span 
class="ectt-1000">callback </span>function) already runs in parallel with the main thread.</li></ol>
<a 
 id="x1-1020r1"></a>
                                                                  

                                                                  
<!--l. 122--><p class="noindent" ><div class="minipage"><span 
class="ecbx-1000">Algorithm</span>
<span 
class="ecbx-1000">1.1:</span> <span 
class="eccc1000-"><span 
class="small-caps">B</span><span 
class="small-caps">u</span><span 
class="small-caps">f</span><span 
class="small-caps">f</span><span 
class="small-caps">e</span><span 
class="small-caps">r</span><span 
class="small-caps">_</span><span 
class="small-caps">I</span><span 
class="small-caps">n</span><span 
class="small-caps">t</span><span 
class="small-caps">e</span><span 
class="small-caps">r</span><span 
class="small-caps">C</span><span 
class="small-caps">o</span><span 
class="small-caps">m</span></span>(<!--l. 105--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
> </mi></math>)<br 
class="newline" /> <!--l. 105--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mtable  align="axis" style=""  
equalrows="false" columnlines="none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/> <mstyle 
class="mbox"><mtext  >procedure </mtext></mstyle><mstyle 
class="mbox"><mtext  ></mtext><mtext class="textsc" mathvariant="normal" >Record_Send_and_Play</mtext></mstyle><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
> </mi></mrow><mo 
class="MathClass-close">)</mo></mrow>                                      </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/>  <mtable  align="axis" style=""  
equalrows="false" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  align="axis" style=""  
equalrows="false" columnlines="none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mstyle> <mo 
class="MathClass-rel">←</mo><mstyle mathvariant="monospace"><mi 
>r</mi><mi 
>e</mi><mi 
>c</mi><mi 
>o</mi><mi 
>r</mi><mi 
>d</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle>                </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>p</mi><mi 
>a</mi><mi 
>c</mi><mi 
>k</mi><mi 
>e</mi><mi 
>d</mi><mstyle 
class="text"><mtext  >_</mtext></mstyle><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mstyle> <mo 
class="MathClass-rel">←</mo><mstyle mathvariant="monospace"><mi 
>p</mi><mi 
>a</mi><mi 
>c</mi><mi 
>k</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle></mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>s</mi><mi 
>e</mi><mi 
>n</mi><mi 
>d</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>p</mi><mi 
>a</mi><mi 
>c</mi><mi 
>k</mi><mi 
>e</mi><mi 
>d</mi><mstyle 
class="text"><mtext  >_</mtext></mstyle><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle>             </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mstyle> <mo 
class="MathClass-rel">←</mo><mstyle mathvariant="monospace"><mi 
>u</mi><mi 
>n</mi><mi 
>b</mi><mi 
>u</mi><mi 
>f</mi><mi 
>f</mi><mi 
>e</mi><mi 
>r</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle>             </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>p</mi><mi 
>l</mi><mi 
>a</mi><mi 
>y</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle>                        </mtd></mtr><!--@{}lr@{}--></mtable>                                                 </mrow></mfenced></mtd>
 </mtr><!--@{\pcode@tab {1}}l@{}--></mtable>                                                                                                  </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/> <mstyle 
class="mbox"><mtext  >procedure </mtext></mstyle><mstyle 
class="mbox"><mtext  ></mtext><mtext class="textsc" mathvariant="normal" >Receive_and_Buffer</mtext></mstyle><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
> </mi></mrow><mo 
class="MathClass-close">)</mo></mrow>                                            </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/>  <mtable  align="axis" style=""  
equalrows="false" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  align="axis" style=""  
equalrows="false" columnlines="none" equalcolumns="false" class="array"> <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>p</mi><mi 
>a</mi><mi 
>c</mi><mi 
>k</mi><mi 
>e</mi><mi 
>d</mi><mstyle 
class="text"><mtext  >_</mtext></mstyle><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mstyle> <mo 
class="MathClass-rel">←</mo><mstyle mathvariant="monospace"><mi 
>r</mi><mi 
>e</mi><mi 
>c</mi><mi 
>e</mi><mi 
>i</mi><mi 
>v</mi><mi 
>e</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle>                           </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi><mstyle 
class="text"><mtext  >_</mtext></mstyle><mi 
>n</mi><mi 
>u</mi><mi 
>m</mi><mi 
>b</mi><mi 
>e</mi><mi 
>r</mi></mstyle><mo 
class="MathClass-punc">,</mo><mstyle mathvariant="monospace"><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mstyle> <mo 
class="MathClass-rel">←</mo><mstyle mathvariant="monospace"><mi 
>u</mi><mi 
>n</mi><mi 
>p</mi><mi 
>a</mi><mi 
>c</mi><mi 
>k</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>p</mi><mi 
>a</mi><mi 
>c</mi><mi 
>k</mi><mi 
>e</mi><mi 
>d</mi><mstyle 
class="text"><mtext  >_</mtext></mstyle><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle></mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mstyle mathvariant="monospace"><mi 
>b</mi><mi 
>u</mi><mi 
>f</mi><mi 
>f</mi><mi 
>e</mi><mi 
>r</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi><mstyle 
class="text"><mtext  >_</mtext></mstyle><mi 
>n</mi><mi 
>u</mi><mi 
>m</mi><mi 
>b</mi><mi 
>e</mi><mi 
>r</mi><mo 
class="MathClass-punc">,</mo><mi 
>c</mi><mi 
>h</mi><mi 
>u</mi><mi 
>n</mi><mi 
>k</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mstyle>                        </mtd></mtr><!--@{}lr@{}--></mtable>                          </mrow></mfenced></mtd>
 </mtr><!--@{\pcode@tab {1}}l@{}--></mtable>                                                                                                  </mtd>
</mtr>  <mtr><mtd 
class="array"  columnalign="left"><mspace width="4.3045pt"/>                                                                                                   </mtd></mtr><!--@{\pcode@tab {1}}lr@{}--></mtable></math></div>
</p>
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-20002"></a>Timming</h3>
<!--l. 127--><p class="noindent" >Please, ﬁnish this milestone in two weeks.
</p><!--l. 129--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-30003"></a>Deliverables</h3>
<!--l. 131--><p class="noindent" >A python module called <span 
class="ectt-1000">buffer.py </span>stored in the root directory of the intercom’s
repo.
</p><!--l. 134--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-40004"></a>Resources</h3>
   <div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
 [1]<span class="bibsp">   </span></span><a 
 id="XKurose-Ross"></a>James F.  Kurose  and  Keith W.  Ross.     <a 
href="https://docs.google.com/viewer?a=v&pid=sites&srcid=Z2FyZGl2aWR5YXBpdGguYWMuaW58aXQyMDE0LTIwMTh8Z3g6OTY5ZDcxZjRmZDBkYzI3" ><span 
class="ecti-1000">Computer  Networking:  A</span>
   <span 
class="ecti-1000">Top-Down Approach Featuring the Internet</span></a>. Pearson, 2013.
</p>
   </div>
<a 
 id="Q1-1-5"></a>
    
</body> 
</html>
                                                                  


